@using Elmah.Models;
@using Elmah.Resx;
@using Framework.Models;
@model PagedSearchViewModel<ElmahErrorAdvancedQuery, ElmahErrorModel.DefaultView[]>
@inject IUIStrings localizor;
@{
    ViewData["Title"] = @localizor.Get("Search") + " " + localizor.Get("ElmahError");
    var format_All = localizor.Get("Format_All");
}
<form asp-controller="ElmahError" asp-action="Index" id="thisform" method="post">
    <input type="hidden" asp-for="Query.PageIndex" id="pageIndexH" />
    <input type="hidden" asp-for="Query.PageSize" id="pageSizeH" />
    <input type="hidden" asp-for="Query.OrderBys" id="orderByH" />
    <div class="d-flex flex-row-reverse pt-1">
        <button class="btn btn-primary me-1 ms-1" role="button" type="submit" title="@localizor.Get("Search")">
            <i class="fa fa-search"></i>
            @localizor.Get("Search")
        </button>
    </div>
    <hr />
        <div class="input-group">
            <select asp-for="Query.TextSearchType" asp-items="ViewBag.TextSearchTypeList" class="input-group-text text-start">
            </select>
            <input asp-for="Query.TextSearch" class="form-control" placeholder="@localizor.Get("SearchTextDescription")" aria-label="@localizor.Get("SearchTextDescription")" />
        </div>
    <div class="row pt-1">
    <div class="row pt-1">
        <div class="col-lg-6">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("TimeUtcRange")</label>
                <select asp-for="Query.TimeUtcRange" asp-items="ViewBag.TimeUtcRangeList" class="form-control form-select datetime-predefinedrange"></select>
                <input asp-for="Query.TimeUtcRangeLower" class="form-control" readonly />
                <input asp-for="Query.TimeUtcRangeUpper" class="form-control" readonly />
            </div>
        </div>
    </div>
    </div>
    <div class="row pt-1">
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahUser")</label>
                <select asp-for="Query.User" class="form-control form-select" asp-items="ViewBag.UserList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahUser"))</option>
                </select>
            </div>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahType")</label>
                <select asp-for="Query.Type" class="form-control form-select" asp-items="ViewBag.TypeList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahType"))</option>
                </select>
            </div>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahStatusCode")</label>
                <select asp-for="Query.StatusCode" class="form-control form-select" asp-items="ViewBag.StatusCodeList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahStatusCode"))</option>
                </select>
            </div>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahSource")</label>
                <select asp-for="Query.Source" class="form-control form-select" asp-items="ViewBag.SourceList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahSource"))</option>
                </select>
            </div>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahHost")</label>
                <select asp-for="Query.Host" class="form-control form-select" asp-items="ViewBag.HostList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahHost"))</option>
                </select>
            </div>
        </div>
        <div class="col-md-6 col-lg-4 col-xl-3">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("ElmahApplication")</label>
                <select asp-for="Query.Application" class="form-control form-select" asp-items="ViewBag.ApplicationList" >
                    <option value="" selected>@string.Format(format_All, localizor.Get("ElmahApplication"))</option>
                </select>
            </div>
        </div>
    </div>
    <div class="row pt-1">
        <div class="col-md-6">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("Message")</label>
                <select asp-for="Query.MessageSearchType" asp-items="ViewBag.TextSearchTypeList" class="input-group-text text-start">
                </select>
                <input asp-for="Query.Message" class="form-control" placeholder="@string.Format(@localizor.Get("Format_SearchTextDescription"), @localizor.Get("Message"))" aria-label="@string.Format(@localizor.Get("Format_SearchTextDescription"), @localizor.Get("Message"))" />
            </div>
        </div>
        <div class="col-md-6">
            <div class="input-group">
                <label class="input-group-text">@localizor.Get("AllXml")</label>
                <select asp-for="Query.AllXmlSearchType" asp-items="ViewBag.TextSearchTypeList" class="input-group-text text-start">
                </select>
                <input asp-for="Query.AllXml" class="form-control" placeholder="@string.Format(@localizor.Get("Format_SearchTextDescription"), @localizor.Get("AllXml"))" aria-label="@string.Format(@localizor.Get("Format_SearchTextDescription"), @localizor.Get("AllXml"))" />
            </div>
        </div>
    </div>
    <div class="d-flex flex-row-reverse pt-2 pb-2">
        <button class="btn btn-primary me-1 ms-1" role="button" type="submit" title="@localizor.Get("Search")">
            <i class="fa fa-search"></i>
            @localizor.Get("Search")
        </button>
    </div>
</form>
<hr />
<div class="card">
    <div class="card-header">
        <h3 class="card-title float-start m-0" ><a class="nav-link text-dark" asp-area="" asp-controller="ElmahError" asp-action="Index">@localizor.Get("ElmahError")</a></h3>
        <div class="btn-group float-end mt-1">
            <a asp-area="" asp-controller="ElmahError" asp-action="Create" class="btn btn-secondary" role="button" title="@localizor.Get("Create_New")">
                <span class="fa fa-plus"></span>
            </a>
            <a asp-area="" asp-controller="ElmahError" asp-action="Index_Export" asp-route-dataServiceType="Csv" class="btn btn-secondary" role="button" title="@localizor.Get("ExportToCsv")" download>
                <span class="fa fa-download"></span>
            </a>
            <a asp-area="" asp-controller="ElmahError" asp-action="Index_Export" asp-route-dataServiceType="Excel2010" class="btn btn-secondary" role="button" title="@localizor.Get("ExportToExcel")" download>
                <span class="fa fa-download"></span>
            </a>
            <a asp-area="" asp-controller="ElmahError" asp-action="Import" class="btn btn-secondary" role="button" title="@localizor.Get("Import")">
                <span class="fa fa-upload"></span>
            </a>
            <select asp-for="Query.PageSize" asp-items="ViewBag.PageSizeList" role="button" class="form-control form-select" id="pageSize"></select>
            <select asp-for="Query.OrderBys" asp-items="ViewBag.OrderByList" role="button" class="form-control form-select" id="orderBy"></select>
        </div>
    </div>
    <div class="card-body table-responsive p-0">
        <table id="masterList" class="table table-hover table-bordered table-striped">
            <thead class="table-dark">
                <tr class="pt-0 pb-0">
                    <th class="p-0"></th>
                            <th class="pt-0 pb-0">@localizor.Get("ErrorId")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Application")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Host")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Type")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Source")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Message")</th>
                            <th class="pt-0 pb-0">@localizor.Get("User")</th>
                            <th class="pt-0 pb-0">@localizor.Get("StatusCode")</th>
                            <th class="pt-0 pb-0">@localizor.Get("TimeUtc")</th>
                            <th class="pt-0 pb-0">@localizor.Get("Sequence")</th>
                            <th class="pt-0 pb-0">@localizor.Get("AllXml")</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Result.Status == System.Net.HttpStatusCode.OK && Model.Result.ResponseBody != null)
                {
                    for (var i = 0; i < Model.Result.ResponseBody.Length; i++)
                    {
                        <tr class="pt-0 pb-0">
                            <td class="p-0">
                                <div class="btn-group">
                                    <a asp-area="" asp-controller="ElmahError" asp-action="Dashboard" asp-route-errorid="@Model.Result.ResponseBody[i].ErrorId" class="btn btn-secondary" role="button" title="@localizor.Get("Dashboard")">
                                        <i class="fa fa-briefcase"></i>
                                    </a>
                                    <a asp-area="" asp-controller="ElmahError" asp-action="Edit" asp-route-errorid="@Model.Result.ResponseBody[i].ErrorId" class="btn btn-secondary" role="button" title="@localizor.Get("Edit")">
                                        <i class="fa fa-edit"></i>
                                    </a>
                                    <a asp-area="" asp-controller="ElmahError" asp-action="Delete" asp-route-errorid="@Model.Result.ResponseBody[i].ErrorId" class="btn btn-secondary" role="button" title="@localizor.Get("Delete")">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                                    <td class="pt-0 pb-0">@Model.Result.ResponseBody[i].ErrorId</td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahApplication" asp-action="Dashboard" asp-route-application="@Model.Result.ResponseBody[i].Application">@Model.Result.ResponseBody[i].Application_Name</a></td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahHost" asp-action="Dashboard" asp-route-host="@Model.Result.ResponseBody[i].Host">@Model.Result.ResponseBody[i].Host_Name</a></td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahType" asp-action="Dashboard" asp-route-type="@Model.Result.ResponseBody[i].Type">@Model.Result.ResponseBody[i].Type_Name</a></td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahSource" asp-action="Dashboard" asp-route-source="@Model.Result.ResponseBody[i].Source">@Model.Result.ResponseBody[i].Source_Name</a></td>
                                    <td class="pt-0 pb-0">@Model.Result.ResponseBody[i].Message</td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahUser" asp-action="Dashboard" asp-route-user="@Model.Result.ResponseBody[i].User">@Model.Result.ResponseBody[i].User_Name</a></td>
                                    <td class="pt-0 pb-0"><a asp-area="" asp-controller="ElmahStatusCode" asp-action="Dashboard" asp-route-statuscode="@Model.Result.ResponseBody[i].StatusCode">@Model.Result.ResponseBody[i].StatusCode_Name</a></td>
                                    <td class="pt-0 pb-0">@Model.Result.ResponseBody[i].TimeUtc</td>
                                    <td class="pt-0 pb-0">@Model.Result.ResponseBody[i].Sequence</td>
                                    <td class="pt-0 pb-0">@Model.Result.ResponseBody[i].AllXml</td>
                        </tr>
                    }
                }
                else if (Model != null)
                {
                    <tr>
                        <td colspan="50">
                            <div class="text-danger">@Model.Result.StatusMessage</div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    @if (Model != null && Model.Result != null && Model.Result.Pagination != null)
    {
        <div class="card-footer">
            @await Html.PartialAsync("~/Views/Shared/_Pagination.cshtml", Model.Result.Pagination)
        </div>
    }
</div>
@section Scripts {
    @if(@Context.Request.Method != "GET")
    {
<script type="text/javascript">
    $(document).ready($(function() {
        location.href = "#masterList";
    }));
</script>
    }
}
